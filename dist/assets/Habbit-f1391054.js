var N=Object.defineProperty;var O=(i,s,t)=>s in i?N(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var _=(i,s,t)=>(O(i,typeof s!="symbol"?s+"":s,t),t);import{e as F,r as R,R as A,f as D,O as W,S as v,l as S,m as n,A as C,o as g,x as j,z as o,k as c,aI as I,P as u,aq as P,ar as U,y as E,j as B,V as q,U as G,E as J,aJ as Y,N as K}from"./index-0e95c451.js";import{E as Q}from"./el-card-18463732.js";import{E as X,a as Z}from"./el-table-column-4f775ad1.js";import"./el-tag-50e9abe9.js";import"./el-scrollbar-52888195.js";import{E as ee}from"./el-progress-aa271fb3.js";import{E as te}from"./el-switch-762f3edc.js";/* empty css                        */import{E as ae,f as se}from"./el-button-cf97a925.js";import{E as re}from"./index-984597dc.js";import{b as ne}from"./index-3b6a7a14.js";class h{constructor(s){_(this,"date");s?this.date=new Date(s):this.date=new Date}toString(){let s=this.date.getMonth()+1,t=this.date.getDate();return s<10&&(s="0"+s),t<10&&(t="0"+t),this.date.getFullYear()+"-"+s+"-"+t}goToDaysLater(s){this.date.setDate(this.date.getDate()+s)}goToFirstDayOfThisWeek(){var s=this.date.getDay();this.goToDaysLater(s==0?-6:1-s)}}class oe{constructor(){_(this,"start_day","");_(this,"end_day","");_(this,"today","");_(this,"first_day_this_week","");_(this,"week_titles",["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]);_(this,"data",[])}}const le={class:"card-header"},ce={key:0},ie=F({__name:"Habbit",setup(i){const s=R(!1);var t=A(new oe);const y=D(()=>{for(var a=[],e=new h(t.start_day),r=0;r<7;r++)a.push(e.toString()),e.goToDaysLater(1);return a}),b=a=>{if(a==0){var e=new h;e.goToFirstDayOfThisWeek()}else{var e=new h(t.start_day);e.goToDaysLater(a>0?7:-7)}e.toString()!=t.start_day&&(t.start_day=e.toString(),e.goToDaysLater(6),t.end_day=e.toString(),T())},T=()=>(v.getHabbitRecordByDateRange(t.start_day,t.end_day).then(a=>(t.data.forEach(e=>{e.checks=[!1,!1,!1,!1,!1,!1,!1];for(var r=0;r<e.checks.length;r++)e.checks[r]=a.data.results.some(d=>d.habbit==e.id&&y.value[r]==d.date)}),!0)).catch(a=>!1),!0),f=D(()=>a=>{var e=0;return a.checks.forEach(r=>e+=r?1:0),{percentage:Math.min(100,Math.round(e*100/a.times_per_week)),status:e<a.times_per_week?"warning":"success",text:`${e}/${a.times_per_week}`}});W(()=>{s.value=!1;var a=new h;t.today=a.toString(),a.goToFirstDayOfThisWeek(),t.start_day=a.toString(),t.first_day_this_week=t.start_day,a.goToDaysLater(6),t.end_day=a.toString(),v.getHabbits().then(e=>{t.data=e.data.results,t.data.forEach(r=>r.checks=[!1,!1,!1,!1,!1,!1,!1])}).catch(e=>{}),T(),s.value=!0});const H=async(a,e)=>{var r=!1;await ne.confirm(`【${a.name}】`+(a.checks[e]?"确定打卡吗？":"确定取消打卡吗？"),"请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await v.postHabbitRecord(a.id,y.value[e],a.checks[e]).then(d=>r=!0).catch(d=>r=!1)}).catch(d=>r=!1),r||(a.checks[e]=!a.checks[e])};return(a,e)=>{const r=J,d=re,k=ae,V=se,m=X,L=te,z=ee,$=Z,M=Q;return s.value?(g(),S(M,{key:0},{header:n(()=>[j("div",le,[o(d,{effect:"dark",type:"success"},{default:n(()=>[o(r,null,{default:n(()=>[o(c(I))]),_:1}),u("【小习惯，大成就】")]),_:1}),o(V,null,{default:n(()=>[o(k,{type:"success",icon:c(P),size:"small",onClick:e[0]||(e[0]=l=>b(-1))},{default:n(()=>[u("上周")]),_:1},8,["icon"]),o(k,{type:"success",size:"small",onClick:e[1]||(e[1]=l=>b(0))},{default:n(()=>[u("今天")]),_:1}),o(k,{disabled:c(t).start_day>=c(t).first_day_this_week,type:"success",size:"small",onClick:e[2]||(e[2]=l=>b(1))},{default:n(()=>[u("下周"),o(r,{class:"el-icon--right"},{default:n(()=>[o(c(U))]),_:1})]),_:1},8,["disabled"])]),_:1})])]),default:n(()=>[o($,{data:c(t).data,border:"",style:{width:"100%","font-size":"12px"},"table-layout":"auto",stripe:"","row-style":{height:"0px"},"cell-style":{padding:"0px"},"header-cell-style":{padding:"0px"}},{default:n(()=>[o(m,{label:"名称",fixed:"",align:"center"},{default:n(l=>[u(E(l.row.name),1),l.row.description.length>0?(g(),B("span",ce,"("+E(l.row.description)+")",1)):C("",!0)]),_:1}),(g(!0),B(G,null,q(c(y),(l,p)=>(g(),S(m,{align:"center",label:l.substring(5)},{default:n(()=>[o(m,{align:"center",label:c(t).week_titles[p],"class-name":l==c(t).today?"bg-gray":"default_cell"},{default:n(w=>[o(L,{size:"small",style:{"--el-switch-on-color":"#13ce66"},modelValue:w.row.checks[p],"onUpdate:modelValue":x=>w.row.checks[p]=x,"inline-prompt":"","active-icon":c(Y),onChange:x=>H(w.row,p)},null,8,["modelValue","onUpdate:modelValue","active-icon","onChange"])]),_:2},1032,["label","class-name"])]),_:2},1032,["label"]))),256)),o(m,{label:"进度",align:"center"},{default:n(l=>[o(z,{percentage:c(f)(l.row).percentage,status:c(f)(l.row).status},{default:n(()=>[o(d,{round:"",type:c(f)(l.row).status},{default:n(()=>[u(E(c(f)(l.row).text),1)]),_:2},1032,["type"])]),_:2},1032,["percentage","status"])]),_:1})]),_:1},8,["data"])]),_:1})):C("",!0)}}});const de=K(ie,[["__scopeId","data-v-0fcc0120"]]),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{h as A,de as H,Ee as a};
