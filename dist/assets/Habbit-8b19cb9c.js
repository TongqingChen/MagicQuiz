var I=Object.defineProperty;var M=(d,s,t)=>s in d?I(d,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[s]=t;var u=(d,s,t)=>(M(d,typeof s!="symbol"?s+"":s,t),t);import{d as N,N as U,x as $,c as D,p as O,A as m,e as S,w as o,g as B,o as y,k as R,l as n,f as i,az as W,q as f,ai as j,aj as P,t as E,a as C,y as q,F as G,E as Y,aA as J,m as K}from"./index-28534dab.js";import{E as Q}from"./el-card-839af9d2.js";import{E as X,a as Z}from"./el-table-column-51bbec9c.js";import"./el-tag-c05b83a6.js";import"./el-scrollbar-9be32fa1.js";import{E as ee}from"./el-progress-65ce0c3c.js";import{E as te}from"./el-switch-1762b96b.js";/* empty css                        */import{E as ae,f as se}from"./el-button-898efb30.js";import{E as re}from"./index-ff69b880.js";import{E as oe}from"./index-ca622293.js";class b{constructor(s){u(this,"date");s?this.date=new Date(s):this.date=new Date}toString(){let s=this.date.getMonth()+1,t=this.date.getDate();return s<10&&(s="0"+s),t<10&&(t="0"+t),this.date.getFullYear()+"-"+s+"-"+t}goToDaysLater(s){this.date.setDate(this.date.getDate()+s)}goToFirstDayOfThisWeek(){this.goToDaysLater(-(this.date.getDay()-1))}}class ne{constructor(){u(this,"start_day","");u(this,"end_day","");u(this,"today","");u(this,"week_titles",["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]);u(this,"data",[])}}const le={class:"card-header"},ce={key:0},ie=N({__name:"Habbit",setup(d){const s=U(!1);var t=$(new ne);const k=D(()=>{for(var a=[],e=new b(t.start_day),r=0;r<7;r++)a.push(e.toString()),e.goToDaysLater(1);return a}),v=a=>{if(a==0){var e=new b;e.goToFirstDayOfThisWeek()}else{var e=new b(t.start_day);e.goToDaysLater(a>0?7:-7)}e.toString()!=t.start_day&&(t.start_day=e.toString(),e.goToDaysLater(6),t.end_day=e.toString(),T())},T=()=>{var a=m.loadUserIdFromStorage();return m.getHabbitRecordByUserIdAndDateRange(a,t.start_day,t.end_day).then(e=>(t.data.forEach(r=>{r.checks=[!1,!1,!1,!1,!1,!1,!1];for(var c=0;c<r.checks.length;c++)r.checks[c]=e.data.results.some(_=>_.habbit==r.id&&k.value[c]==_.date)}),!0)).catch(e=>!1),!0},g=D(()=>a=>{var e=0;return a.checks.forEach(r=>e+=r?1:0),{percentage:Math.min(100,Math.round(e*100/a.times_per_week)),status:e<a.times_per_week?"warning":"success",text:`${e}/${a.times_per_week}`}});O(()=>{s.value=!1;var a=new b;t.today=a.toString(),a.goToFirstDayOfThisWeek(),t.start_day=a.toString(),a.goToDaysLater(6),t.end_day=a.toString();var e=m.loadUserIdFromStorage();m.getHabbitsByUserId(e).then(r=>{t.data=r.data.results,t.data.forEach(c=>c.checks=[!1,!1,!1,!1,!1,!1,!1])}).catch(r=>{}),T(),s.value=!0});const H=async(a,e)=>{var r=!1;await oe.confirm("确定打卡吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await m.postHabbitRecord(a.id,k.value[e],a.checks[e]).then(c=>r=!0).catch(c=>r=!1)}).catch(c=>r=!1),r||(a.checks[e]=!a.checks[e])};return(a,e)=>{const r=Y,c=re,_=ae,V=se,p=X,F=te,L=ee,z=Z,A=Q;return s.value?(y(),S(A,{key:0},{header:o(()=>[R("div",le,[n(c,{effect:"dark",type:"success"},{default:o(()=>[n(r,null,{default:o(()=>[n(i(W))]),_:1}),f("【小习惯，大成就】")]),_:1}),n(V,null,{default:o(()=>[n(_,{type:"success",icon:i(j),size:"small",onClick:e[0]||(e[0]=l=>v(-1))},{default:o(()=>[f("上周")]),_:1},8,["icon"]),n(_,{type:"success",size:"small",onClick:e[1]||(e[1]=l=>v(0))},{default:o(()=>[f("今天")]),_:1}),n(_,{type:"success",size:"small",onClick:e[2]||(e[2]=l=>v(1))},{default:o(()=>[f("下周"),n(r,{class:"el-icon--right"},{default:o(()=>[n(i(P))]),_:1})]),_:1})]),_:1})])]),default:o(()=>[n(z,{data:i(t).data,border:"",style:{width:"100%","font-size":"12px"},"table-layout":"auto","row-style":{height:"0px"},"cell-style":{padding:"0px"},"header-cell-style":{padding:"0px"}},{default:o(()=>[n(p,{label:"名称",fixed:"",align:"center"},{default:o(l=>[f(E(l.row.name),1),l.row.description.length>0?(y(),C("span",ce,"("+E(l.row.description)+")",1)):B("",!0)]),_:1}),(y(!0),C(G,null,q(i(k),(l,h)=>(y(),S(p,{align:"center",label:l},{default:o(()=>[n(p,{align:"center",label:i(t).week_titles[h],"class-name":l==i(t).today?"bg-gray":"default_cell"},{default:o(w=>[n(F,{size:"small",style:{"--el-switch-on-color":"#13ce66"},modelValue:w.row.checks[h],"onUpdate:modelValue":x=>w.row.checks[h]=x,"inline-prompt":"","active-icon":i(J),onChange:x=>H(w.row,h)},null,8,["modelValue","onUpdate:modelValue","active-icon","onChange"])]),_:2},1032,["label","class-name"])]),_:2},1032,["label"]))),256)),n(p,{label:"进度",align:"center"},{default:o(l=>[n(L,{percentage:i(g)(l.row).percentage,status:i(g)(l.row).status},{default:o(()=>[n(c,{round:"",type:i(g)(l.row).status},{default:o(()=>[f(E(i(g)(l.row).text),1)]),_:2},1032,["type"])]),_:2},1032,["percentage","status"])]),_:1})]),_:1},8,["data"])]),_:1})):B("",!0)}}});const de=K(ie,[["__scopeId","data-v-8a06c7b8"]]),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{b as A,de as H,Ee as a};
