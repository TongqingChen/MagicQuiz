import{d as Y,ct as Z,k as z,r as G,h as ee,e as te,A as x,af as se,cu as ae,o as p,c as E,w as i,b as l,a as A,t as b,u as s,f as d,p as k,s as M,q as h,F as R,aW as ne,cf as oe,aL as ie,aM as re,l as le,aT as V,E as ue,cv as de,y as ce,c7 as me,$ as pe,bd as _e,a3 as fe,c8 as ye,c9 as ge,_ as be}from"./index-56ef5580.js";import{E as he}from"./el-image-viewer-2778631b.js";import{b as ve,a as xe}from"./el-radio-group-9052001e.js";/* empty css                 */import{E as Ee}from"./el-switch-ae25c26c.js";import{E as we}from"./el-text-d3e20cae.js";import{E as Ne}from"./el-tag-497bb1cc.js";import{E as Ie}from"./el-divider-6a408b57.js";import{a as ke,E as f,b as Le,c as O,Q as Ae}from"./http-f85647fc.js";import{a as Ce}from"./settings-5434be94.js";import{F as Te}from"./FlipCounter-ce7eaaef.js";import"./debounce-43569316.js";const Be={style:{margin:"5px"}},Ge={key:1,class:"question-zone"},Oe={style:{"padding-left":"6px","padding-top":"5px"}},Se={class:"user-answer"},Ve={key:0,class:"answer"},De={key:1,class:"answer"},Fe={key:2},Qe={class:"question"},$e={class:"title"},ze=Y({__name:"Exam",setup(Me){const v=Z(),D=z(!0),e=G(new ke);let w=G([]),y=G([[0,0]]);const T=z(!0),U=ee(()=>T.value?"primary":"info"),H=async()=>{e.id=Number(v.query.id),e.state=f.IDLE,e.start_time=Date.now(),e.name=String(v.query.name),e.subjectName=String(v.query.sub_name),e.exam_seconds=Number(v.query.exam_seconds),e.question_num=0,await x.getQuestionTypes().then(r=>{w=r.data}).catch(r=>{le.error(`获取题型失败!${r}`)}),w.forEach(r=>{e.meta.push({typeId:r[0],typeName:r[1],icon:"Message",qList:[]})}),e.scores=0;var u=0;if(y=[],e.id>=0)await x.getQuestionListByQuizId(e.id).then(r=>{let m=r.data.results;m.sort((t,o)=>t.type-o.type),m.forEach(t=>{var o=w.findIndex(I=>I[0]==t.type);y.push([o,e.meta[t.type].qList.length]),e.meta[o].qList.push({index:u++,id:t.id,type:t.type,title:t.title,description:t.description,image:t.image,difficulty_level:t.difficulty_level,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"",score:t.score,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=m.length,e.state=f.ONGOING});else if(e.id==-1)await x.getWrongSetsMixedBySubName(e.subjectName).then(r=>{const m=r.data[e.subjectName];m.sort((t,o)=>t.type_id-o.type_id),m.forEach(t=>{var o=w.findIndex(I=>I[0]==t.type_id);y.push([o,e.meta[t.type_id].qList.length]),e.meta[o].qList.push({index:u++,id:t.qid,type:t.type_id,title:t.title,description:t.description,image:t.image,difficulty_level:0,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"未作答",score:t.score,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=m.length,e.state=f.ONGOING});else if(e.id==-2){var n=Number(v.query.choice_num),c=Number(v.query.logic_num),g=Number(v.query.blank_num),N=Number(v.query.coding_num);await x.getQuestionListRandom(e.subjectName,[n,c,g,N]).then(r=>{let m=r.data;m.sort((t,o)=>t.type-o.type),m.forEach(t=>{var o=w.findIndex(I=>I[0]==t.type);y.push([o,e.meta[t.type].qList.length]),e.meta[o].qList.push({index:u++,id:t.id,type:t.type,title:t.title,description:t.description,image:t.image,difficulty_level:t.difficulty_level,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"",score:t.score,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=m.length,e.state=f.ONGOING})}};te(async()=>{var u=x.loadSettings();u&&(D.value=u.data[Ce.EXAM_TIME_BLINK].value),await H(),e.question_num>0&&C(0)}),se(()=>{e.state=f.FINISHED}),ae((u,n,c)=>{if(e.state!=f.ONGOING){c();return}V.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(()=>{c(!1)}).catch(g=>{g=="cancel"?c():c(!1)})});let a=G(new Le);const C=u=>{a.copyFrom(e.meta[y[u][0]].qList[y[u][1]])},j=()=>{var u=y[a.index][0],n=y[a.index][1];e.meta[u].qList[n].doubt=!e.meta[u].qList[n].doubt},S=()=>{if(a.index>=0&&e.state==f.ONGOING){var u=y[a.index][0],n=y[a.index][1];e.meta[u].qList[n].userAnswer=a.userAnswer,e.meta[u].qList[n].displayType=a.userAnswer.length>0?"primary":"default",T.value&&a.index<e.question_num-1&&a.userAnswer.length>0&&C(a.index+1)}},F=async()=>{e.state=f.FINISHED;var u=x.loadUserIdFromStorage(),n=new Ae,c=0,g=[],N=[];w.forEach(t=>{g.push(0),N.push(0)});var r=0;e.meta.forEach(t=>{t.qList.forEach(o=>{o.displayType=o.userAnswer==o.answer?"success":"danger",o.userAnswer==o.answer&&(n.meta.abs_score+=o.score,g[r]++),o.type!=O.CODING&&(c+=o.score,n.questions.push({user:u,question:o.id,user_answer:o.userAnswer,is_correct:o.userAnswer==o.answer}))}),N[r]=t.qList.length-g[r],r++}),r=0;var m="";w.forEach(t=>{n.meta.note+=`${t[1]}:${g[r]}/${e.meta[r].qList.length},`,m+=`【${t[1]}】<b>${g[r]}</b> ✅, <b>${N[r]}</b> ❌<br/>`,r++}),n.meta.user=u,n.meta.quiz=e.id,n.meta.rel_score=Math.round(n.meta.abs_score*100/c),n.meta.use_minutes=Math.max(1,Math.round((Date.now()-e.start_time)/1e3/60)),await x.postQuestionsResult(n.questions),e.id>=0&&await x.postQuizResult(n.meta),V.alert(`【得分】${n.meta.abs_score}/${c}<br/>`+(n.meta.abs_score==c?"【信息】恭喜您获得满分💯<br/>":m)+`【用时】<b>${((Date.now()-e.start_time)/1e3/60).toFixed(2)}</b>分钟<br/>`,"考试结果",{type:n.meta.abs_score==c?"success":"error",dangerouslyUseHTMLString:!0})},q=()=>{V.confirm("确定结束考试并交卷吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{F()})};return(u,n)=>{const c=ue,g=de,N=Ie,r=ce,m=me,t=Ne,o=we,I=Ee,K=pe,P=_e,L=ve,Q=xe,W=fe,X=he,J=ye,$=ge;return p(),E($,{class:"layout-container-exam",style:{height:"100%"}},{default:i(()=>[l(g,null,{default:i(()=>[A("span",null,"【"+b(e.subjectName)+"】"+b(e.name),1),l(Te,{seconds:e.exam_seconds,type:3,split:D.value,timeUnit:[":",":",":"],stop:e.state==s(f).FINISHED,onTimeUp:F},null,8,["seconds","split","stop"]),l(c,{link:"",type:"primary",disabled:e.state!=s(f).ONGOING,onClick:q},{default:i(()=>[d("交卷")]),_:1},8,["disabled"])]),_:1}),l($,null,{default:i(()=>[l(m,{width:"164px"},{default:i(()=>[l(r,{style:{height:"100%"}},{default:i(()=>[(p(!0),k(R,null,M(e.meta,_=>(p(),k("div",Be,[_.qList.length>0?(p(),E(N,{key:0},{default:i(()=>[d(b(_.typeName),1)]),_:2},1024)):h("",!0),_.qList.length>0?(p(),k("div",Ge,[(p(!0),k(R,null,M(_.qList,B=>(p(),E(c,{type:B.displayType,onClick:Re=>C(B.index)},{default:i(()=>[d(b(B.doubt?"❓":B.index+1),1)]),_:2},1032,["type","onClick"]))),256))])):h("",!0)]))),256))]),_:1})]),_:1}),(s(a).index>=0,p(),E(J,{key:0},{default:i(()=>[A("div",Oe,[A("div",Se,[l(t,{size:"small",effect:"dark"},{default:i(()=>[d("考生答案")]),_:1}),d(b(s(a).userAnswer),1)]),e.state==s(f).FINISHED?(p(),k("div",Ve,[l(t,{size:"small",type:"success",effect:"dark"},{default:i(()=>[d("正确答案")]),_:1}),d(b(s(a).answer),1)])):h("",!0),e.state==s(f).FINISHED?(p(),k("div",De,[l(t,{size:"small",type:"success",effect:"dark"},{default:i(()=>[d("题目解析")]),_:1}),d(b(s(a).analysis),1)])):h("",!0),l(o,{type:s(U),size:"small",style:{"padding-left":"6px"}},{default:i(()=>[d("自动下题")]),_:1},8,["type"]),l(I,{modelValue:T.value,"onUpdate:modelValue":n[0]||(n[0]=_=>T.value=_),"inline-prompt":"","active-icon":s(ne),"inactive-icon":s(oe)},null,8,["modelValue","active-icon","inactive-icon"]),l(P,{style:{"padding-left":"6px"}},{default:i(()=>[l(c,{disabled:s(a).index<0||s(a).index>=s(y).length||e.state!=s(f).ONGOING,type:"primary",size:"small",onClick:j},{default:i(()=>[d("❓存疑")]),_:1},8,["disabled"]),l(c,{disabled:s(a).index==0,type:"primary",icon:s(ie),size:"small",onClick:n[1]||(n[1]=_=>C(s(a).index-1))},{default:i(()=>[d("上题")]),_:1},8,["disabled","icon"]),l(c,{disabled:s(a).index==s(y).length-1,type:"primary",size:"small",onClick:n[2]||(n[2]=_=>C(s(a).index+1))},{default:i(()=>[d("下题"),l(K,{class:"el-icon--right"},{default:i(()=>[l(s(re))]),_:1})]),_:1},8,["disabled"])]),_:1}),e.state==s(f).ONGOING?(p(),k("div",Fe,[s(a).type==s(O).CHOICE?(p(),E(Q,{key:0,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[3]||(n[3]=_=>s(a).userAnswer=_),onChange:S},{default:i(()=>[l(L,{label:"A"},{default:i(()=>[d("A")]),_:1}),l(L,{label:"B"},{default:i(()=>[d("B")]),_:1}),l(L,{label:"C"},{default:i(()=>[d("C")]),_:1}),l(L,{label:"D"},{default:i(()=>[d("D")]),_:1})]),_:1},8,["modelValue"])):h("",!0),s(a).type==s(O).LOGIC?(p(),E(Q,{key:1,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[4]||(n[4]=_=>s(a).userAnswer=_),onChange:S},{default:i(()=>[l(L,{label:"T"},{default:i(()=>[d("正确")]),_:1}),l(L,{label:"F"},{default:i(()=>[d("错误")]),_:1})]),_:1},8,["modelValue"])):h("",!0),s(a).type==s(O).BLANK?(p(),E(W,{key:2,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[5]||(n[5]=_=>s(a).userAnswer=_),placeholder:"请填入答案，多个答案以英文分号隔开，如: 134;2;abc",clearable:"",onBlur:S},null,8,["modelValue"])):h("",!0)])):h("",!0)]),A("div",Qe,[A("div",$e,b(s(a).index+1)+". ("+b(s(a).score)+"分)"+b(s(a).title),1),s(a).image?(p(),E(X,{key:0,src:s(a).image,fit:"scale-down"},null,8,["src"])):h("",!0),A("div",null,b(s(a).description),1)])]),_:1}))]),_:1})]),_:1})}}});const tt=be(ze,[["__scopeId","data-v-2c6f6f31"]]);export{tt as default};
