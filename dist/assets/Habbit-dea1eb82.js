var N=Object.defineProperty;var A=(d,s,t)=>s in d?N(d,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[s]=t;var D=(d,s,t)=>(A(d,typeof s!="symbol"?s+"":s,t),t);import{d as O,j as R,r as W,h as C,e as j,A as w,o as h,c as H,w as r,a as I,b as l,p as i,ax as P,f as u,ay as U,az as q,t as E,m as S,q as B,s as G,aA as Y,F as J,ao as K,a3 as Q,E as X,aB as Z,_ as ee}from"./index-89aeeb22.js";import{E as te}from"./el-card-463835d3.js";import{E as ae,a as se}from"./el-table-column-00f217c6.js";import{E as ne}from"./el-progress-989f01d7.js";import{E as re}from"./el-switch-1fa63a71.js";import{E as le}from"./el-tag-a9b17241.js";import{H as oe}from"./habbit-c31728ad.js";class p{constructor(s){D(this,"date");s?this.date=new Date(s):this.date=new Date}toString(){let s=this.date.getMonth()+1,t=this.date.getDate();return s<10&&(s="0"+s),t<10&&(t="0"+t),this.date.getFullYear()+"-"+s+"-"+t}goToDaysLater(s){this.date.setDate(this.date.getDate()+s)}goToFirstDayOfThisWeek(){var s=this.date.getDay();s!=1&&this.goToDaysLater(s==0?-6:1-s)}}const ce={class:"card-header"},ie={key:0},de=O({__name:"Habbit",setup(d){const s=R(!1);var t=W(new oe);const y=C(()=>{for(var a=[],e=new p(t.start_day),n=["周一","周二","周三","周四","周五","周六","周日"],c=0;c<7;c++){var _=0;t.data.forEach(v=>_+=v.checks[c]?1:0),a.push({date:e.toString(),week:`${n[c]}(${_})`}),e.goToDaysLater(1)}return a}),V=({row:a,rowIndex:e})=>e%2?"success-row":"",b=a=>{if(a==0){var e=new p;e.goToFirstDayOfThisWeek()}else{var e=new p(t.start_day);e.goToDaysLater(a>0?7:-7)}e.toString()!=t.start_day&&(t.start_day=e.toString(),e.goToDaysLater(6),t.end_day=e.toString(),x())},x=()=>(w.getHabbitRecordByDateRange(t.start_day,t.end_day).then(a=>(t.data.forEach(e=>{e.checks=[!1,!1,!1,!1,!1,!1,!1];for(var n=0;n<e.checks.length;n++)e.checks[n]=a.data.results.some(c=>c.habbit==e.id&&y.value[n].date==c.date)}),!0)).catch(a=>!1),!0),f=C(()=>a=>{var e=0;return a.checks.forEach(n=>e+=n?1:0),{percentage:Math.min(100,Math.round(e*100/a.times_per_week)),status:e<a.times_per_week?"warning":"success",text:`${e}/${a.times_per_week}`}});j(()=>{s.value=!1;var a=new p;t.today=a.toString(),a.goToFirstDayOfThisWeek(),t.start_day=a.toString(),t.first_day_this_week=t.start_day,a.goToDaysLater(6),t.end_day=a.toString(),w.getHabbits().then(e=>{t.data=e.data.results,t.data.forEach(n=>{n.checks=[!1,!1,!1,!1,!1,!1,!1]})}).catch(e=>{}),x(),s.value=!0});const $=async(a,e)=>{var n=!1;await K.confirm(`【${a.name}】`+(a.checks[e]?"确定打卡吗？":"确定取消打卡吗？"),"请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await w.postHabbitRecord(a.id,y.value[e].date,a.checks[e]).then(c=>n=!0).catch(c=>n=!1)}).catch(c=>n=!1),n||(a.checks[e]=!a.checks[e])};return(a,e)=>{const n=Q,c=le,_=X,v=Z,g=ae,L=re,z=ne,F=se,M=te;return s.value?(h(),H(M,{key:0},{header:r(()=>[I("div",ce,[l(c,{effect:"dark",type:"success"},{default:r(()=>[l(n,null,{default:r(()=>[l(i(P))]),_:1}),u("【小习惯，大成就】")]),_:1}),l(v,null,{default:r(()=>[l(_,{type:"success",icon:i(U),size:"small",onClick:e[0]||(e[0]=o=>b(-1))},{default:r(()=>[u("上周")]),_:1},8,["icon"]),l(_,{type:"success",size:"small",onClick:e[1]||(e[1]=o=>b(0))},{default:r(()=>[u("今天")]),_:1}),l(_,{disabled:i(t).start_day>=i(t).first_day_this_week,type:"success",size:"small",onClick:e[2]||(e[2]=o=>b(1))},{default:r(()=>[u("下周"),l(n,{class:"el-icon--right"},{default:r(()=>[l(i(q))]),_:1})]),_:1},8,["disabled"])]),_:1})])]),default:r(()=>[l(F,{data:i(t).data,border:"",style:{width:"100%","font-size":"12px"},"table-layout":"auto","row-class-name":V,"row-style":{height:"0px"},"cell-style":{padding:"0px"},"header-cell-style":{padding:"0px"}},{default:r(()=>[l(g,{label:"名称",fixed:"",align:"center"},{default:r(o=>[u(E(o.row.name),1),o.row.description.length>0?(h(),S("span",ie,"("+E(o.row.description)+")",1)):B("",!0)]),_:1}),(h(!0),S(J,null,G(y.value,(o,m)=>(h(),H(g,{align:"center",label:o.date.substring(5),"label-class-name":m>=5?"bg-gray":"default_cell"},{default:r(()=>[l(g,{align:"center",label:o.week,"class-name":o.date==i(t).today?"bg-gray":"default_cell"},{default:r(k=>[l(L,{size:"small",style:{"--el-switch-on-color":"#13ce66"},modelValue:k.row.checks[m],"onUpdate:modelValue":T=>k.row.checks[m]=T,"inline-prompt":"","active-icon":i(Y),onChange:T=>$(k.row,m)},null,8,["modelValue","onUpdate:modelValue","active-icon","onChange"])]),_:2},1032,["label","class-name"])]),_:2},1032,["label","label-class-name"]))),256)),l(g,{label:"进度",align:"center"},{default:r(o=>[l(z,{percentage:f.value(o.row).percentage,status:f.value(o.row).status},{default:r(()=>[l(c,{round:"",type:f.value(o.row).status},{default:r(()=>[u(E(f.value(o.row).text),1)]),_:2},1032,["type"])]),_:2},1032,["percentage","status"])]),_:1})]),_:1},8,["data"])]),_:1})):B("",!0)}}});const _e=ee(de,[["__scopeId","data-v-c186cc1b"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{p as A,_e as H,ve as a};
