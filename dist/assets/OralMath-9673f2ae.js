import{e as O,R as B,O as M,S as u,bf as v,l as E,m as n,bh as C,bg as S,o as m,z as o,x as i,y as d,k as p,P as V,j as D,V as R,U as q,bi as G,bk as z,N as F}from"./index-3ca15ee5.js";import{E as T,a as H}from"./el-row-ba34f6cc.js";import{E as Q}from"./el-card-73de2de0.js";/* empty css                 */import{E as U}from"./el-button-341327a6.js";import{a as r,_ as $}from"./Timer.vue_vue_type_script_setup_true_lang-17d798dc.js";import{Q as L}from"./http-67e17b5c.js";import{E as A}from"./index-d32961b4.js";import{b as h}from"./index-f762d9c9.js";import{E as P}from"./index-ffbeeece.js";import"./validator-95ca852c.js";const j={class:"question"},J=O({__name:"OralMath",setup(K){const e=B({id:0,name:"",state:r.IDLE,exam_seconds:0,start_time:0,meta:[{title:"",answer:0,user_answer:0,mark:""}]}),_=C();M(()=>{e.id=Number(_.query.id),e.name=String(_.query.name),e.exam_seconds=Number(_.query.exam_seconds),e.state=r.ONGOING,u.getOralMath(e.id).then(s=>{e.meta=[],s.data.forEach(l=>e.meta.push({title:l[0],answer:l[1],user_answer:0,mark:""})),e.start_time=Date.now()})});const f=async()=>{e.state=r.FINISHED;var s=0;e.meta.forEach(a=>{a.mark=a.answer==a.user_answer?"✅":"❌",s+=a.answer==a.user_answer?1:0});var l=u.loadUserIdFromStorage(),t=new L;t.meta.note=`[${e.name}]${s}/${e.meta.length}`,t.meta.user=l,t.meta.quiz=e.id,t.meta.abs_score=s,t.meta.rel_score=Math.round(s*100/e.meta.length),t.meta.use_minutes=Math.round((Date.now()-e.start_time)/1e3/60),await u.postQuizResult(t.meta),A.success("考试提交成功!")},w=()=>{h.confirm("确定提交并结束考试吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f()})};return v((s,l,t)=>{if(e.state!=r.ONGOING){t();return}h.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(a=>{t(!1)}).catch(a=>{a=="cancel"?t():t(!1)})}),(s,l)=>{const t=U,a=G,b=P,x=Q,g=H,y=T,N=z,I=S;return m(),E(I,null,{default:n(()=>[o(a,null,{default:n(()=>[i("span",null,"【"+d(e.name)+"】",1),o($,{style:{color:"red"},start_flag:e.state==p(r).ONGOING,duration_secs:e.exam_seconds,blink:!0,start_text:"【已用时间】",count_down:!1,onEnd_event:f},null,8,["start_flag","duration_secs"]),o(t,{link:"",type:"primary",disabled:e.state==p(r).FINISHED,onClick:w},{default:n(()=>[V("提交")]),_:1},8,["disabled"])]),_:1}),o(N,null,{default:n(()=>[o(y,{gutter:16,class:"q-body"},{default:n(()=>[(m(!0),D(q,null,R(e.meta,c=>(m(),E(g,{xs:24,sm:12,md:8,lg:6,xl:4},{default:n(()=>[o(x,null,{default:n(()=>[i("span",j,d(c.title),1),o(b,{modelValue:c.user_answer,"onUpdate:modelValue":k=>c.user_answer=k,max:999,clearable:"",type:"number",disabled:e.state==p(r).FINISHED},null,8,["modelValue","onUpdate:modelValue","disabled"]),i("span",null,d(c.mark),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}});const le=F(J,[["__scopeId","data-v-11f933c6"]]);export{le as default};
