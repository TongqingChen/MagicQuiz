import{b as U,ac as J,d as k,u as K,c as W,o as l,a as v,n as D,f as d,h as X,g,s as Y,_ as Z,j as ee,v as G,p as te,b9 as se,e as x,w as a,A as I,ba as ae,l as o,k as h,t as c,q as m,x as Q,F as T,aj as ne,bb as oe,bc as re,bd as ie,y as le,E as de,be as ue,m as ce}from"./index-d1ec9bbb.js";import{E as me}from"./el-image-viewer-0cb31d71.js";import{b as pe,E as _e}from"./el-radio-group-ef48116d.js";/* empty css                 */import{E as fe}from"./el-scrollbar-74816bdc.js";import{E as ye,a as ge}from"./el-button-39435904.js";import{E as ve,a as p,Q as _,b as be,_ as we,c as $}from"./Timer.vue_vue_type_script_setup_true_lang-c4b7f0ae.js";import{Q as Ee}from"./http-6cc81244.js";import{E as xe}from"./index-e60a1986.js";import"./use-form-item-d6cebf64.js";import"./index-5a242a52.js";import"./scroll-6b723a30.js";import"./index-d6e4858e.js";import"./index-abb94269.js";import"./validator-40838779.js";const he=U({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:J(String),default:"solid"}}),Ie=k({name:"ElDivider"}),Ce=k({...Ie,props:he,setup(L){const b=L,e=K("divider"),f=W(()=>e.cssVar({"border-style":b.borderStyle}));return(w,z)=>(l(),v("div",{class:D([d(e).b(),d(e).m(w.direction)]),style:Y(d(f)),role:"separator"},[w.$slots.default&&w.direction!=="vertical"?(l(),v("div",{key:0,class:D([d(e).e("text"),d(e).is(w.contentPosition)])},[X(w.$slots,"default")],2)):g("v-if",!0)],6))}});var Ne=Z(Ce,[["__file","/home/runner/work/element-plus/element-plus/packages/components/divider/src/divider.vue"]]);const Oe=ee(Ne);const Ge={style:{margin:"5px"}},ke={class:"question-zone"},Le={style:{"padding-left":"10px","padding-top":"5px"}},ze={key:0,class:"answer"},Se={key:1,class:"answer"},Ae={class:"question"},Be={key:0,class:"title"},De=k({__name:"Exam",setup(L){const b=oe(),e=G(new ve);let f=G([[0,0]]);const w=()=>{e.id=Number(b.query.id),e.state=p.IDLE,e.start_time=Date.now(),e.name=String(b.query.name),e.subjectId=Number(b.query.subjectId),e.subjectName=String(b.query.subjectName),e.exam_seconds=Number(b.query.exam_seconds),I.getQuestionListByQuizId(e.id).then(u=>{let s=u.data.results;e.meta=[{typeId:_.CHOICE,typeName:"选择",icon:"Message",qList:[]},{typeId:_.LOGIC,typeName:"判断",icon:"Setttings",qList:[]},{typeId:_.CODING,typeName:"编程",icon:"Menu",qList:[]}],e.scores=0,f=[];var r=0;s.forEach(n=>{f.push([n.type,e.meta[n.type].qList.length]),e.meta[n.type].qList.push({index:r++,id:n.id,type:n.type,title:n.title,description:n.description,image:n.image,answer:n.answer,displayType:"default",userAnswer:"未作答",score:n.score}),e.scores+=n.score}),e.state=p.ONGOING})},z=()=>{V()};te(()=>{w()}),se((u,s,r)=>{if(e.state!=p.ONGOING){r();return}$.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(n=>{r(!1)}).catch(n=>{n=="cancel"?r():r(!1)})});const t=G({meta:new be,answers:["","",""]}),C=u=>{let s=e.meta[f[u][0]].qList[f[u][1]];t.meta=s,t.answers[t.meta.type]=s.userAnswer},S=()=>{if(t.meta.index>=0&&e.state==p.ONGOING){var u=f[t.meta.index][0],s=f[t.meta.index][1];e.meta[u].qList[s].userAnswer=t.answers[t.meta.type],e.meta[u].qList[s].displayType="primary"}},V=async()=>{var u=I.loadUserIdFromStorage(),s=new Ee,r=0,n=[0,0,0];e.meta.forEach(N=>{N.qList.forEach(i=>{i.displayType=i.userAnswer==i.answer?"success":"danger",i.userAnswer==i.answer&&(s.meta.abs_score+=i.score,n[i.type]++),i.type!=_.CODING&&(r+=i.score,s.questions.push({user:u,question:i.id,is_correct:i.userAnswer==i.answer}))})}),s.meta.note=`选择: ${n[_.CHOICE]}/${e.meta[_.CHOICE].qList.length}, 判断: ${n[_.LOGIC]}/${e.meta[_.LOGIC].qList.length}`,s.meta.user=u,s.meta.quiz=e.id,s.meta.rel_score=Math.round(s.meta.abs_score*100/r),s.meta.use_minutes=Math.round((Date.now()-e.start_time)/1e3/60),await I.postQuestionsResult(s.questions),await I.postQuizResult(s.meta),xe.success("考试提交成功!")},R=()=>{$.confirm("确定提交并结束考试吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.state=p.FINISHED})};return(u,s)=>{const r=ye,n=re,N=Oe,i=fe,M=ie,j=le("ArrowRight"),H=de,P=ge,E=pe,A=_e,F=me,q=ue,B=ae;return l(),x(B,{class:"layout-container-exam",style:{height:"100%"}},{default:a(()=>[o(n,null,{default:a(()=>[h("span",null,"【"+c(e.subjectName)+"】"+c(e.name)+"【总分: "+c(e.scores)+"】",1),o(we,{style:{color:"red"},start_flag:e.state==d(p).ONGOING,duration_secs:e.exam_seconds,blink:!0,start_text:"【考试剩余】",onEnd_event:z},null,8,["start_flag","duration_secs"]),o(r,{link:"",type:"primary",disabled:e.state!=d(p).ONGOING,onClick:R},{default:a(()=>[m("提交")]),_:1},8,["disabled"])]),_:1}),o(B,null,{default:a(()=>[o(M,{width:"170px"},{default:a(()=>[o(i,{style:{height:"100%"}},{default:a(()=>[(l(!0),v(T,null,Q(e.meta,y=>(l(),v("div",Ge,[o(N,null,{default:a(()=>[m(c(y.typeName),1)]),_:2},1024),h("div",ke,[(l(!0),v(T,null,Q(y.qList,O=>(l(),x(r,{type:O.displayType,class:"question-button",onClick:Qe=>C(O.index)},{default:a(()=>[m(c(O.index+1),1)]),_:2},1032,["type","onClick"]))),256))])]))),256))]),_:1})]),_:1}),o(q,null,{default:a(()=>[h("div",Le,[t.meta.index>=0?(l(),v("div",ze,"【考生答案】"+c(t.meta.userAnswer),1)):g("",!0),e.state==d(p).FINISHED&&t.meta.index>=0?(l(),v("div",Se," 【正确答案】"+c(t.meta.answer),1)):g("",!0),t.meta.index>=0?(l(),x(P,{key:2},{default:a(()=>[o(r,{disabled:t.meta.index==0,type:"primary",icon:d(ne),size:"small",onClick:s[0]||(s[0]=y=>C(t.meta.index-1))},{default:a(()=>[m("上一题")]),_:1},8,["disabled","icon"]),o(r,{disabled:t.meta.index==d(f).length-1,type:"primary",size:"small",onClick:s[1]||(s[1]=y=>C(t.meta.index+1))},{default:a(()=>[m("下一题"),o(H,{class:"el-icon--right"},{default:a(()=>[o(j)]),_:1})]),_:1},8,["disabled"])]),_:1})):g("",!0),t.meta.type==d(_).CHOICE&&e.state==d(p).ONGOING?(l(),x(A,{key:3,modelValue:t.answers[0],"onUpdate:modelValue":s[2]||(s[2]=y=>t.answers[0]=y),onChange:S},{default:a(()=>[o(E,{label:"A",size:"small"},{default:a(()=>[m("A")]),_:1}),o(E,{label:"B",size:"small"},{default:a(()=>[m("B")]),_:1}),o(E,{label:"C",size:"small"},{default:a(()=>[m("C")]),_:1}),o(E,{label:"D",size:"small"},{default:a(()=>[m("D")]),_:1})]),_:1},8,["modelValue"])):g("",!0),t.meta.type==d(_).LOGIC&&e.state==d(p).ONGOING?(l(),x(A,{key:4,modelValue:t.answers[1],"onUpdate:modelValue":s[3]||(s[3]=y=>t.answers[1]=y),onChange:S},{default:a(()=>[o(E,{label:"T",size:"small"},{default:a(()=>[m("正确")]),_:1}),o(E,{label:"F",size:"small"},{default:a(()=>[m("错误")]),_:1})]),_:1},8,["modelValue"])):g("",!0)]),h("div",Ae,[t.meta.index>=0?(l(),v("div",Be,c(t.meta.index+1)+". ("+c(t.meta.score)+"分)"+c(t.meta.title),1)):g("",!0),t.meta.image!=null?(l(),x(F,{key:1,src:t.meta.image,fit:"scale-down"},null,8,["src"])):g("",!0),h("div",null,c(t.meta.description),1)])]),_:1})]),_:1})]),_:1})}}});const Ye=ce(De,[["__scopeId","data-v-55219415"]]);export{Ye as default};
