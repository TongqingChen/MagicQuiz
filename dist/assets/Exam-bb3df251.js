import{d as te,c9 as se,j as M,r as F,h as ae,e as ne,A as N,bv as oe,ca as ie,o as p,c as I,w as r,b as u,a as q,t as v,p as s,f as c,m as k,s as j,q as h,F as H,aA as re,bQ as le,ay as ue,az as de,av as ce,aw as me,k as R,ao as T,E as _e,cb as pe,y as fe,bD as ye,a3 as ge,aB as ve,a7 as be,bE as he,bF as xe,_ as Ne}from"./index-fed7c948.js";import{E as Ee}from"./el-image-viewer-1ed91e83.js";import{b as Ie,a as we}from"./el-radio-group-b731278a.js";/* empty css                 */import{E as ke}from"./el-switch-923b7374.js";import{E as Le}from"./el-text-c260b595.js";import{E as qe}from"./el-tag-de887b4f.js";import{E as Ae}from"./el-divider-b7c844d3.js";import{a as Ce,E as f,Q as D,F as Be,b as G}from"./FlipCounter-0323ae18.js";import{Q as Se}from"./http-364f4a0d.js";import{a as Fe}from"./settings-5434be94.js";import"./debounce-2dbe537a.js";const Ge={style:{margin:"5px"}},Oe={key:1,class:"question-zone"},Te={style:{"padding-left":"6px","padding-top":"5px"}},De={class:"user-answer"},Qe={key:0,class:"answer"},Ve={key:2},ze={class:"question"},$e={class:"title"},Me={key:0,style:{"padding-left":"6px","padding-top":"5px"},class:"answer"},je=te({__name:"Exam",setup(He){const x=se(),Q=M(!0),e=F(new Ce);let w=F([]),y=F([[0,0]]);const B=M(!0),U=ae(()=>B.value?"primary":"info"),K=async()=>{e.id=Number(x.query.id),e.state=f.IDLE,e.start_time=Date.now(),e.name=String(x.query.name),e.subjectName=String(x.query.subject),e.gradeName=String(x.query.grade),e.volumeName=String(x.query.volume),e.exam_seconds=Number(x.query.exam_seconds),e.question_num=0,await N.getQuestionTypes().then(i=>{w=i.data}).catch(i=>{R.error(`获取题型失败!${i}`)}),w.forEach(i=>{e.meta.push({typeId:i[0],typeName:i[1],icon:"Message",qList:[]})}),e.scores=0;var l=0;if(y=[],e.id>0)await N.getQuestionListByQuizId(e.id).then(i=>{let d=i.data;d.sort((t,o)=>t.type-o.type),d.forEach(t=>{var o=w.findIndex(C=>C[0]==t.type);y.push([o,e.meta[t.type].qList.length]);var _=new D;_.copyFrom(t),_.index=l++,_.userAnswer="",_.displayType="default",e.meta[o].qList.push(_),e.scores+=t.score}),e.question_num=d.length,e.state=f.ONGOING});else if(e.id==-1)await N.getWrongSetsMixedBySubInfos([e.subjectName,e.gradeName,e.volumeName]).then(i=>{const d=i.data.questions;d.sort((t,o)=>t.type_id-o.type_id),d.forEach(t=>{var o=w.findIndex(_=>_[0]==t.type_id);y.push([o,e.meta[t.type_id].qList.length]),e.meta[o].qList.push({index:l++,id:t.qid,type:t.type_id,title:t.title,description:t.description,image:t.image,difficulty_level:0,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"未作答",score:t.score,is_favourited:t.is_favourited,wrong_times:t.wrong_times,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=f.ONGOING});else if(e.id==-2){var n=Number(x.query.choice_num),m=Number(x.query.logic_num),b=Number(x.query.blank_num),E=Number(x.query.coding_num);await N.getQuestionListRandom([e.subjectName,e.gradeName,e.volumeName],[n,m,b,E]).then(i=>{let d=i.data;d.sort((t,o)=>t.type-o.type),d.forEach(t=>{var o=w.findIndex(C=>C[0]==t.type);y.push([o,e.meta[t.type].qList.length]);var _=new D;_.copyFrom(t),_.index=l++,_.userAnswer="",_.displayType="default",e.meta[o].qList.push(_),e.scores+=t.score}),e.question_num=d.length,e.state=f.ONGOING})}else e.id==-3&&await N.getFavouriteSetsBySubInfos([e.subjectName,e.gradeName,e.volumeName]).then(i=>{const d=i.data.questions;d.sort((t,o)=>t.type_id-o.type_id),d.forEach(t=>{var o=w.findIndex(_=>_[0]==t.type_id);y.push([o,e.meta[t.type_id].qList.length]),e.meta[o].qList.push({index:l++,id:t.qid,type:t.type_id,title:t.title,description:t.description,image:t.image,difficulty_level:0,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"未作答",score:t.score,is_favourited:t.is_favourited,wrong_times:t.wrong_times,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=f.ONGOING})};ne(async()=>{var l=N.loadSettings();l&&(Q.value=l.data[Fe.EXAM_TIME_BLINK].value),await K(),e.question_num>0&&A(0)}),oe(()=>{e.state=f.FINISHED}),ie((l,n,m)=>{if(e.state!=f.ONGOING){m();return}T.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(()=>{m(!1)}).catch(b=>{b=="cancel"?m():m(!1)})});let a=F(new D);const A=l=>{a.copyFrom(e.meta[y[l][0]].qList[y[l][1]])},P=()=>{var l=y[a.index][0],n=y[a.index][1];e.meta[l].qList[n].doubt=!e.meta[l].qList[n].doubt},O=()=>{if(a.index>=0&&e.state==f.ONGOING){var l=y[a.index][0],n=y[a.index][1];e.meta[l].qList[n].userAnswer=a.userAnswer,e.meta[l].qList[n].displayType=a.userAnswer.length>0?"primary":"default",B.value&&a.index<e.question_num-1&&a.userAnswer.length>0&&A(a.index+1)}},V=async()=>{e.state=f.FINISHED;var l=N.loadUserIdFromStorage(),n=new Se,m=0,b=[],E=[];w.forEach(t=>{b.push(0),E.push(0)});var i=0;e.meta.forEach(t=>{t.qList.forEach(o=>{o.displayType=o.userAnswer==o.answer?"success":"danger",o.userAnswer==o.answer&&(n.meta.abs_score+=o.score,b[i]++),o.type!=G.CODING&&(m+=o.score,n.questions.push({user:l,question:o.id,user_answer:o.userAnswer,is_correct:o.userAnswer==o.answer}))}),E[i]=t.qList.length-b[i],i++}),i=0;var d="";w.forEach(t=>{n.meta.note+=`${t[1]}:${b[i]}/${e.meta[i].qList.length},`,b[i]+E[i]>0&&(d+=`【${t[1]}】`,b[i]>0&&(d+=`<b>${b[i]}</b> ✅, `),E[i]>0&&(d+=`<b>${E[i]}</b> ❌<br/>`)),i++}),n.meta.user=l,n.meta.quiz=e.id,n.meta.rel_score=Math.round(n.meta.abs_score*100/m),n.meta.use_minutes=Math.max(1,Math.round((Date.now()-e.start_time)/1e3/60)),await N.postQuestionsResult(n.questions),e.id>=0&&await N.postQuizResult(n.meta),T.alert(`【得分】${n.meta.abs_score}/${m}<br/>`+(n.meta.abs_score==m?"【信息】恭喜您获得满分💯<br/>":d)+`【用时】<b>${((Date.now()-e.start_time)/1e3/60).toFixed(2)}</b>分钟<br/>`,"考试结果",{type:n.meta.abs_score==m?"success":"error",dangerouslyUseHTMLString:!0})},W=()=>{T.confirm("确定结束考试并交卷吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V()})},X=async()=>{await N.postFavouriteQuestion(a.id).then(()=>{var l=y[a.index][0],n=y[a.index][1];e.meta[l].qList[n].is_favourited=!0,a.is_favourited=!0,R.success("收藏成功")})};return(l,n)=>{const m=_e,b=pe,E=Ae,i=fe,d=ye,t=qe,o=Le,_=ke,C=ge,J=ve,L=Ie,z=we,Y=be,Z=Ee,ee=he,$=xe;return p(),I($,{class:"layout-container-exam",style:{height:"100%"}},{default:r(()=>[u(b,null,{default:r(()=>[q("span",null,"【"+v(e.subjectName)+"💠"+v(e.gradeName)+"💠"+v(e.volumeName)+"】"+v(e.name),1),u(Be,{seconds:e.exam_seconds,type:3,split:Q.value,timeUnit:[":",":",":"],stop:e.state==s(f).FINISHED,onTimeUp:V},null,8,["seconds","split","stop"]),u(m,{link:"",type:"primary",disabled:e.state!=s(f).ONGOING,onClick:W},{default:r(()=>[c("交卷")]),_:1},8,["disabled"])]),_:1}),u($,null,{default:r(()=>[u(d,{width:"164px"},{default:r(()=>[u(i,{style:{height:"100%"}},{default:r(()=>[(p(!0),k(H,null,j(e.meta,g=>(p(),k("div",Ge,[g.qList.length>0?(p(),I(E,{key:0},{default:r(()=>[c(v(g.typeName),1)]),_:2},1024)):h("",!0),g.qList.length>0?(p(),k("div",Oe,[(p(!0),k(H,null,j(g.qList,S=>(p(),I(m,{type:S.displayType,onClick:Re=>A(S.index)},{default:r(()=>[c(v(S.doubt?"❓":S.index+1),1)]),_:2},1032,["type","onClick"]))),256))])):h("",!0)]))),256))]),_:1})]),_:1}),s(a).index>=0?(p(),I(ee,{key:0},{default:r(()=>[q("div",Te,[q("div",De,[u(t,{size:"small",effect:"dark"},{default:r(()=>[c("考生答案")]),_:1}),c(v(s(a).userAnswer),1)]),e.state==s(f).FINISHED?(p(),k("div",Qe,[u(t,{size:"small",type:"success",effect:"dark"},{default:r(()=>[c("正确答案")]),_:1}),c(v(s(a).answer),1)])):h("",!0),u(o,{type:U.value,size:"small",style:{"padding-left":"6px"}},{default:r(()=>[c("自动下题")]),_:1},8,["type"]),u(_,{modelValue:B.value,"onUpdate:modelValue":n[0]||(n[0]=g=>B.value=g),"inline-prompt":"","active-icon":s(re),"inactive-icon":s(le)},null,8,["modelValue","active-icon","inactive-icon"]),u(J,{style:{"padding-left":"6px"}},{default:r(()=>[u(m,{disabled:s(a).index<0||s(a).index>=s(y).length||e.state!=s(f).ONGOING,type:"primary",size:"small",onClick:P},{default:r(()=>[c("❓存疑")]),_:1},8,["disabled"]),u(m,{disabled:s(a).index==0,type:"primary",icon:s(ue),size:"small",onClick:n[1]||(n[1]=g=>A(s(a).index-1))},{default:r(()=>[c("上题")]),_:1},8,["disabled","icon"]),u(m,{disabled:s(a).index==s(y).length-1,type:"primary",size:"small",onClick:n[2]||(n[2]=g=>A(s(a).index+1))},{default:r(()=>[c("下题"),u(C,{class:"el-icon--right"},{default:r(()=>[u(s(de))]),_:1})]),_:1},8,["disabled"])]),_:1}),e.state==s(f).FINISHED?(p(),I(m,{key:1,type:"success",icon:s(a).is_favourited?s(ce):s(me),round:"",size:"small",onClick:X,disabled:s(a).is_favourited},{default:r(()=>[c(v(s(a).is_favourited?"已收藏":"收藏"),1)]),_:1},8,["icon","disabled"])):h("",!0),e.state==s(f).ONGOING?(p(),k("div",Ve,[s(a).type==s(G).CHOICE?(p(),I(z,{key:0,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[3]||(n[3]=g=>s(a).userAnswer=g),onChange:O},{default:r(()=>[u(L,{label:"A"},{default:r(()=>[c("A")]),_:1}),u(L,{label:"B"},{default:r(()=>[c("B")]),_:1}),u(L,{label:"C"},{default:r(()=>[c("C")]),_:1}),u(L,{label:"D"},{default:r(()=>[c("D")]),_:1})]),_:1},8,["modelValue"])):h("",!0),s(a).type==s(G).LOGIC?(p(),I(z,{key:1,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[4]||(n[4]=g=>s(a).userAnswer=g),onChange:O},{default:r(()=>[u(L,{label:"T"},{default:r(()=>[c("正确")]),_:1}),u(L,{label:"F"},{default:r(()=>[c("错误")]),_:1})]),_:1},8,["modelValue"])):h("",!0),s(a).type==s(G).BLANK?(p(),I(Y,{key:2,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[5]||(n[5]=g=>s(a).userAnswer=g),placeholder:"请填入答案，多个答案以英文分号隔开，如: 134;2;abc",clearable:"",onBlur:O},null,8,["modelValue"])):h("",!0)])):h("",!0)]),q("div",ze,[q("div",$e,v(s(a).index+1)+". ("+v(s(a).score)+"分)"+v(s(a).title),1),s(a).image?(p(),I(Z,{key:0,src:s(a).image,fit:"scale-down"},null,8,["src"])):h("",!0),q("div",null,v(s(a).description),1)]),e.state==s(f).FINISHED?(p(),k("div",Me,[u(t,{size:"small",type:"success",effect:"dark"},{default:r(()=>[c("题目解析")]),_:1}),c(v(s(a).analysis),1)])):h("",!0)]),_:1})):h("",!0)]),_:1})]),_:1})}}});const nt=Ne(je,[["__scopeId","data-v-01f4c6a8"]]);export{nt as default};
