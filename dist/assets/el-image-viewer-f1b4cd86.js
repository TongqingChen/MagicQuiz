import{b6 as M,aD as ke,J as ve,ab as ie,bM as me,P as Q,d as ee,ch as fe,ci as Ie,cj as _e,K as pe,G as ge,bp as ze,j as k,ck as Le,ag as Ce,h as v,Y as ue,af as we,e as be,o as b,c as ce,b as c,w as _,a as w,n as d,p as a,g as de,a6 as Ee,q as z,a3 as S,bQ as xe,m as N,F as U,ay as Ne,az as Oe,cl as Se,bR as Te,bd as Re,cm as $e,cn as Ae,s as Be,$ as Me,br as Ve,M as J,bK as Ye,co as De,I as ye,ae as V,ai as B,bI as Pe,N as he,cp as Xe,cq as Fe,t as He,bZ as je,b7 as Ke,a9 as We,at as Ze,cr as qe}from"./index-55c09cc5.js";import{d as Ge}from"./debounce-1d5c5ad0.js";const Je=(r,f)=>{if(!M||!r||!f)return!1;const l=r.getBoundingClientRect();let s;return f instanceof Element?s=f.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<s.bottom&&l.bottom>s.top&&l.right>s.left&&l.left<s.right};var Qe="Expected a function";function re(r,f,l){var s=!0,y=!0;if(typeof r!="function")throw new TypeError(Qe);return ke(l)&&(s="leading"in l?!!l.leading:s,y="trailing"in l?!!l.trailing:y),Ge(r,f,{leading:s,maxWait:f,trailing:y})}const Ue=ve({urlList:{type:ie(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),et={close:()=>!0,switch:r=>Q(r),rotate:r=>Q(r)},tt=["src"],at=ee({name:"ElImageViewer"}),nt=ee({...at,props:Ue,emits:et,setup(r,{expose:f,emit:l}){const s=r,y={CONTAIN:{name:"contain",icon:fe(Ie)},ORIGINAL:{name:"original",icon:fe(_e)}},{t:L}=pe(),i=ge("image-viewer"),{nextZIndex:te}=ze(),T=k(),O=k([]),C=Le(),I=k(!0),m=k(s.initialIndex),p=Ce(y.CONTAIN),u=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),Y=v(()=>{const{urlList:e}=s;return e.length<=1}),$=v(()=>m.value===0),F=v(()=>m.value===s.urlList.length-1),ae=v(()=>s.urlList[m.value]),ne=v(()=>[i.e("btn"),i.e("prev"),i.is("disabled",!s.infinite&&$.value)]),D=v(()=>[i.e("btn"),i.e("next"),i.is("disabled",!s.infinite&&F.value)]),se=v(()=>{const{scale:e,deg:n,offsetX:o,offsetY:g,enableTransition:E}=u.value;let h=o/e,x=g/e;switch(n%360){case 90:case-270:[h,x]=[x,-h];break;case 180:case-180:[h,x]=[-h,-x];break;case 270:case-90:[h,x]=[-x,h];break}const A={transform:`scale(${e}) rotate(${n}deg) translate(${h}px, ${x}px)`,transition:E?"transform .3s":""};return p.value.name===y.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),H=v(()=>Q(s.zIndex)?s.zIndex:te());function R(){oe(),l("close")}function le(){const e=re(o=>{switch(o.code){case B.esc:s.closeOnPressEscape&&R();break;case B.space:Z();break;case B.left:q();break;case B.up:t("zoomIn");break;case B.right:G();break;case B.down:t("zoomOut");break}}),n=re(o=>{const g=o.deltaY||o.deltaX;t(g<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});C.run(()=>{V(document,"keydown",e),V(document,"wheel",n)})}function oe(){C.stop()}function j(){I.value=!1}function K(e){I.value=!1,e.target.alt=L("el.image.error")}function W(e){if(I.value||e.button!==0||!T.value)return;u.value.enableTransition=!1;const{offsetX:n,offsetY:o}=u.value,g=e.pageX,E=e.pageY,h=re(A=>{u.value={...u.value,offsetX:n+A.pageX-g,offsetY:o+A.pageY-E}}),x=V(document,"mousemove",h);V(document,"mouseup",()=>{x()}),e.preventDefault()}function P(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Z(){if(I.value)return;const e=Pe(y),n=Object.values(y),o=p.value.name,E=(n.findIndex(h=>h.name===o)+1)%e.length;p.value=y[e[E]],P()}function X(e){const n=s.urlList.length;m.value=(e+n)%n}function q(){$.value&&!s.infinite||X(m.value-1)}function G(){F.value&&!s.infinite||X(m.value+1)}function t(e,n={}){if(I.value)return;const{zoomRate:o,rotateDeg:g,enableTransition:E}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/o).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*o).toFixed(3)));break;case"clockwise":u.value.deg+=g,l("rotate",u.value.deg);break;case"anticlockwise":u.value.deg-=g,l("rotate",u.value.deg);break}u.value.enableTransition=E}return ue(ae,()=>{we(()=>{const e=O.value[0];e!=null&&e.complete||(I.value=!0)})}),ue(m,e=>{P(),l("switch",e)}),be(()=>{var e,n;le(),(n=(e=T.value)==null?void 0:e.focus)==null||n.call(e)}),f({setActiveItem:X}),(e,n)=>(b(),ce(De,{to:"body",disabled:!e.teleported},[c(Ye,{name:"viewer-fade",appear:""},{default:_(()=>[w("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:d(a(i).e("wrapper")),style:de({zIndex:a(H)})},[w("div",{class:d(a(i).e("mask")),onClick:n[0]||(n[0]=Ee(o=>e.hideOnClickModal&&R(),["self"]))},null,2),z(" CLOSE "),w("span",{class:d([a(i).e("btn"),a(i).e("close")]),onClick:R},[c(a(S),null,{default:_(()=>[c(a(xe))]),_:1})],2),z(" ARROW "),a(Y)?z("v-if",!0):(b(),N(U,{key:0},[w("span",{class:d(a(ne)),onClick:q},[c(a(S),null,{default:_(()=>[c(a(Ne))]),_:1})],2),w("span",{class:d(a(D)),onClick:G},[c(a(S),null,{default:_(()=>[c(a(Oe))]),_:1})],2)],64)),z(" ACTIONS "),w("div",{class:d([a(i).e("btn"),a(i).e("actions")])},[w("div",{class:d(a(i).e("actions__inner"))},[c(a(S),{onClick:n[1]||(n[1]=o=>t("zoomOut"))},{default:_(()=>[c(a(Se))]),_:1}),c(a(S),{onClick:n[2]||(n[2]=o=>t("zoomIn"))},{default:_(()=>[c(a(Te))]),_:1}),w("i",{class:d(a(i).e("actions__divider"))},null,2),c(a(S),{onClick:Z},{default:_(()=>[(b(),ce(Re(a(p).icon)))]),_:1}),w("i",{class:d(a(i).e("actions__divider"))},null,2),c(a(S),{onClick:n[3]||(n[3]=o=>t("anticlockwise"))},{default:_(()=>[c(a($e))]),_:1}),c(a(S),{onClick:n[4]||(n[4]=o=>t("clockwise"))},{default:_(()=>[c(a(Ae))]),_:1})],2)],2),z(" CANVAS "),w("div",{class:d(a(i).e("canvas"))},[(b(!0),N(U,null,Be(e.urlList,(o,g)=>Me((b(),N("img",{ref_for:!0,ref:E=>O.value[g]=E,key:o,src:o,style:de(a(se)),class:d(a(i).e("img")),onLoad:j,onError:K,onMousedown:W},null,46,tt)),[[Ve,g===m.value]])),128))],2),J(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var st=ye(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const lt=he(st),ot=ve({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ie([String,Object])},previewSrcList:{type:ie(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),rt={load:r=>r instanceof Event,error:r=>r instanceof Event,switch:r=>Q(r),close:()=>!0,show:()=>!0},it=["src","loading"],ut={key:0},ct=ee({name:"ElImage",inheritAttrs:!1}),dt=ee({...ct,props:ot,emits:rt,setup(r,{emit:f}){const l=r;let s="";const{t:y}=pe(),L=ge("image"),i=Xe(),te=Fe(),T=k(),O=k(!1),C=k(!0),I=k(!1),m=k(),p=k(),u=M&&"loading"in HTMLImageElement.prototype;let Y,$;const F=v(()=>[L.e("inner"),D.value&&L.e("preview"),C.value&&L.is("loading")]),ae=v(()=>i.style),ne=v(()=>{const{fit:t}=l;return M&&t?{objectFit:t}:{}}),D=v(()=>{const{previewSrcList:t}=l;return Array.isArray(t)&&t.length>0}),se=v(()=>{const{previewSrcList:t,initialIndex:e}=l;let n=e;return e>t.length-1&&(n=0),n}),H=v(()=>l.loading==="eager"?!1:!u&&l.loading==="lazy"||l.lazy),R=()=>{M&&(C.value=!0,O.value=!1,T.value=l.src)};function le(t){C.value=!1,O.value=!1,f("load",t)}function oe(t){C.value=!1,O.value=!0,f("error",t)}function j(){Je(m.value,p.value)&&(R(),P())}const K=qe(j,200,!0);async function W(){var t;if(!M)return;await we();const{scrollContainer:e}=l;Ke(e)?p.value=e:We(e)&&e!==""?p.value=(t=document.querySelector(e))!=null?t:void 0:m.value&&(p.value=Ze(m.value)),p.value&&(Y=V(p,"scroll",K),setTimeout(()=>j(),100))}function P(){!M||!p.value||!K||(Y==null||Y(),p.value=void 0)}function Z(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function X(){D.value&&($=V("wheel",Z,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",I.value=!0,f("show"))}function q(){$==null||$(),document.body.style.overflow=s,I.value=!1,f("close")}function G(t){f("switch",t)}return ue(()=>l.src,()=>{H.value?(C.value=!0,O.value=!1,P(),W()):R()}),be(()=>{H.value?W():R()}),(t,e)=>(b(),N("div",{ref_key:"container",ref:m,class:d([a(L).b(),t.$attrs.class]),style:de(a(ae))},[O.value?J(t.$slots,"error",{key:0},()=>[w("div",{class:d(a(L).e("error"))},He(a(y)("el.image.error")),3)]):(b(),N(U,{key:1},[T.value!==void 0?(b(),N("img",je({key:0},a(te),{src:T.value,loading:t.loading,style:a(ne),class:a(F),onClick:X,onLoad:le,onError:oe}),null,16,it)):z("v-if",!0),C.value?(b(),N("div",{key:1,class:d(a(L).e("wrapper"))},[J(t.$slots,"placeholder",{},()=>[w("div",{class:d(a(L).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),a(D)?(b(),N(U,{key:2},[I.value?(b(),ce(a(lt),{key:0,"z-index":t.zIndex,"initial-index":a(se),infinite:t.infinite,"zoom-rate":t.zoomRate,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:q,onSwitch:G},{default:_(()=>[t.$slots.viewer?(b(),N("div",ut,[J(t.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var ft=ye(dt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const pt=he(ft);export{pt as E};
