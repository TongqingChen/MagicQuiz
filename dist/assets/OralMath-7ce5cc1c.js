import{d as B,x as O,p as M,A as _,b9 as v,e as E,w as n,bb as C,ba as q,o as u,l as o,k as i,t as d,f as p,q as D,a as S,y as V,F,bc as G,be as R,m as T}from"./index-28534dab.js";import{E as z,a as H}from"./el-row-78007e01.js";import{E as Q}from"./el-card-839af9d2.js";/* empty css                 */import{E as $}from"./el-button-898efb30.js";import{a as r,_ as A}from"./Timer.vue_vue_type_script_setup_true_lang-1df9ab43.js";import{Q as L}from"./http-37cefeec.js";import{E as U}from"./index-6cd4b727.js";import{E as h}from"./index-ca622293.js";import{E as P}from"./index-224d0693.js";import"./index-a22de1b4.js";import"./scroll-dc2f35e5.js";import"./validator-e2a941f8.js";import"./index-1e9469b0.js";const j={class:"question"},J=B({__name:"OralMath",setup(K){const e=O({id:0,name:"",state:r.IDLE,exam_seconds:0,start_time:0,meta:[{title:"",answer:0,user_answer:0,mark:""}]}),m=C();M(()=>{e.id=Number(m.query.id),e.name=String(m.query.name),e.exam_seconds=Number(m.query.exam_seconds),e.state=r.ONGOING,_.getOralMath(e.id).then(s=>{e.meta=[],s.data.forEach(l=>e.meta.push({title:l[0],answer:l[1],user_answer:0,mark:""})),e.start_time=Date.now()})});const f=async()=>{e.state=r.FINISHED;var s=0;e.meta.forEach(a=>{a.mark=a.answer==a.user_answer?"✅":"❌",s+=a.answer==a.user_answer?1:0});var l=_.loadUserIdFromStorage(),t=new L;t.meta.note=`[${e.name}]${s}/${e.meta.length}`,t.meta.user=l,t.meta.quiz=e.id,t.meta.abs_score=s,t.meta.rel_score=Math.round(s*100/e.meta.length),t.meta.use_minutes=Math.round((Date.now()-e.start_time)/1e3/60),await _.postQuizResult(t.meta),U.success("考试提交成功!")},w=()=>{h.confirm("确定提交并结束考试吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f()})};return v((s,l,t)=>{if(e.state!=r.ONGOING){t();return}h.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(a=>{t(!1)}).catch(a=>{a=="cancel"?t():t(!1)})}),(s,l)=>{const t=$,a=G,b=P,x=Q,g=H,y=z,N=R,I=q;return u(),E(I,null,{default:n(()=>[o(a,null,{default:n(()=>[i("span",null,"【"+d(e.name)+"】",1),o(A,{style:{color:"red"},start_flag:e.state==p(r).ONGOING,duration_secs:e.exam_seconds,blink:!0,start_text:"【已用时间】",count_down:!1,onEnd_event:f},null,8,["start_flag","duration_secs"]),o(t,{link:"",type:"primary",disabled:e.state==p(r).FINISHED,onClick:w},{default:n(()=>[D("提交")]),_:1},8,["disabled"])]),_:1}),o(N,null,{default:n(()=>[o(y,{gutter:16,class:"q-body"},{default:n(()=>[(u(!0),S(F,null,V(e.meta,c=>(u(),E(g,{xs:24,sm:12,md:8,lg:6,xl:4},{default:n(()=>[o(x,null,{default:n(()=>[i("span",j,d(c.title),1),o(b,{modelValue:c.user_answer,"onUpdate:modelValue":k=>c.user_answer=k,max:999,clearable:"",type:"number",disabled:e.state==p(r).FINISHED},null,8,["modelValue","onUpdate:modelValue","disabled"]),i("span",null,d(c.mark),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}});const _e=T(J,[["__scopeId","data-v-11f933c6"]]);export{_e as default};
