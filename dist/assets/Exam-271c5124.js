import{d as ee,ct as te,k as $,r as G,h as se,e as ae,A as h,af as ne,cu as ie,o as p,c as E,w as r,b as u,a as A,t as g,u as s,f as c,p as k,s as M,q as b,F as j,aW as oe,cf as re,aL as le,aM as ue,cw as de,cx as ce,l as H,aT as S,E as me,cv as pe,y as _e,c7 as fe,$ as ye,bd as ve,a3 as ge,c8 as be,c9 as he,_ as xe}from"./index-e235bd1a.js";import{E as Ee}from"./el-image-viewer-7aeb3789.js";import{b as Ne,a as we}from"./el-radio-group-e4383740.js";/* empty css                 */import{E as Ie}from"./el-switch-65f5068f.js";import{E as ke}from"./el-text-5ee0e48e.js";import{E as Le}from"./el-tag-f794e7b7.js";import{E as Ae}from"./el-divider-74e6fa30.js";import{a as Ce,E as _,b as Te,c as O,Q as Be}from"./http-f1fd749e.js";import{a as Ge}from"./settings-5434be94.js";import{F as Oe}from"./FlipCounter-47447252.js";import"./debounce-5240b141.js";const Fe={style:{margin:"5px"}},Se={key:1,class:"question-zone"},De={style:{"padding-left":"6px","padding-top":"5px"}},Ve={class:"user-answer"},Qe={key:0,class:"answer"},ze={key:2},$e={class:"question"},Me={class:"title"},je={key:0,style:{"padding-left":"6px","padding-top":"5px"},class:"answer"},He=ee({__name:"Exam",setup(Re){const N=te(),D=$(!0),e=G(new Ce);let w=G([]),f=G([[0,0]]);const T=$(!0),R=se(()=>T.value?"primary":"info"),U=async()=>{e.id=Number(N.query.id),e.state=_.IDLE,e.start_time=Date.now(),e.name=String(N.query.name),e.subjectName=String(N.query.sub_name),e.exam_seconds=Number(N.query.exam_seconds),e.question_num=0,await h.getQuestionTypes().then(o=>{w=o.data}).catch(o=>{H.error(`获取题型失败!${o}`)}),w.forEach(o=>{e.meta.push({typeId:o[0],typeName:o[1],icon:"Message",qList:[]})}),e.scores=0;var l=0;if(f=[],e.id>=0)await h.getQuestionListByQuizId(e.id).then(o=>{let d=o.data.results;d.sort((t,i)=>t.type-i.type),d.forEach(t=>{var i=w.findIndex(x=>x[0]==t.type);f.push([i,e.meta[t.type].qList.length]),e.meta[i].qList.push({index:l++,id:t.id,type:t.type,title:t.title,description:t.description,image:t.image,difficulty_level:t.difficulty_level,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"",score:t.score,favourite:!1,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=_.ONGOING});else if(e.id==-1)await h.getWrongSetsMixedBySubName(e.subjectName).then(o=>{const d=o.data[e.subjectName];d.sort((t,i)=>t.type_id-i.type_id),d.forEach(t=>{var i=w.findIndex(x=>x[0]==t.type_id);f.push([i,e.meta[t.type_id].qList.length]),e.meta[i].qList.push({index:l++,id:t.qid,type:t.type_id,title:t.title,description:t.description,image:t.image,difficulty_level:0,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"未作答",score:t.score,favourite:!1,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=_.ONGOING});else if(e.id==-2){var n=Number(N.query.choice_num),m=Number(N.query.logic_num),v=Number(N.query.blank_num),I=Number(N.query.coding_num);await h.getQuestionListRandom(e.subjectName,[n,m,v,I]).then(o=>{let d=o.data;d.sort((t,i)=>t.type-i.type),d.forEach(t=>{var i=w.findIndex(x=>x[0]==t.type);f.push([i,e.meta[t.type].qList.length]),e.meta[i].qList.push({index:l++,id:t.id,type:t.type,title:t.title,description:t.description,image:t.image,difficulty_level:t.difficulty_level,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"",score:t.score,favourite:!1,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=_.ONGOING})}else e.id==-3&&await h.getFavouriteSetsBySubName(e.subjectName).then(o=>{const d=o.data[e.subjectName];d.sort((t,i)=>t.type_id-i.type_id),d.forEach(t=>{var i=w.findIndex(x=>x[0]==t.type_id);f.push([i,e.meta[t.type_id].qList.length]),e.meta[i].qList.push({index:l++,id:t.qid,type:t.type_id,title:t.title,description:t.description,image:t.image,difficulty_level:0,answer:t.answer,doubt:!1,analysis:t.analysis,displayType:"default",userAnswer:"未作答",score:t.score,favourite:!1,copyFrom:()=>{}}),e.scores+=t.score}),e.question_num=d.length,e.state=_.ONGOING})};ae(async()=>{var l=h.loadSettings();l&&(D.value=l.data[Ge.EXAM_TIME_BLINK].value),await U(),e.question_num>0&&C(0)}),ne(()=>{e.state=_.FINISHED}),ie((l,n,m)=>{if(e.state!=_.ONGOING){m();return}S.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(()=>{m(!1)}).catch(v=>{v=="cancel"?m():m(!1)})});let a=G(new Te);const C=l=>{a.copyFrom(e.meta[f[l][0]].qList[f[l][1]])},q=()=>{var l=f[a.index][0],n=f[a.index][1];e.meta[l].qList[n].doubt=!e.meta[l].qList[n].doubt},F=()=>{if(a.index>=0&&e.state==_.ONGOING){var l=f[a.index][0],n=f[a.index][1];e.meta[l].qList[n].userAnswer=a.userAnswer,e.meta[l].qList[n].displayType=a.userAnswer.length>0?"primary":"default",T.value&&a.index<e.question_num-1&&a.userAnswer.length>0&&C(a.index+1)}},V=async()=>{e.state=_.FINISHED;var l=h.loadUserIdFromStorage(),n=new Be,m=0,v=[],I=[];w.forEach(t=>{v.push(0),I.push(0)});var o=0;e.meta.forEach(t=>{t.qList.forEach(i=>{i.displayType=i.userAnswer==i.answer?"success":"danger",i.userAnswer==i.answer&&(n.meta.abs_score+=i.score,v[o]++),i.type!=O.CODING&&(m+=i.score,n.questions.push({user:l,question:i.id,user_answer:i.userAnswer,is_correct:i.userAnswer==i.answer}))}),I[o]=t.qList.length-v[o],o++}),o=0;var d="";w.forEach(t=>{n.meta.note+=`${t[1]}:${v[o]}/${e.meta[o].qList.length},`,d+=`【${t[1]}】<b>${v[o]}</b> ✅, <b>${I[o]}</b> ❌<br/>`,o++}),n.meta.user=l,n.meta.quiz=e.id,n.meta.rel_score=Math.round(n.meta.abs_score*100/m),n.meta.use_minutes=Math.max(1,Math.round((Date.now()-e.start_time)/1e3/60)),await h.postQuestionsResult(n.questions),e.id>=0&&await h.postQuizResult(n.meta),S.alert(`【得分】${n.meta.abs_score}/${m}<br/>`+(n.meta.abs_score==m?"【信息】恭喜您获得满分💯<br/>":d)+`【用时】<b>${((Date.now()-e.start_time)/1e3/60).toFixed(2)}</b>分钟<br/>`,"考试结果",{type:n.meta.abs_score==m?"success":"error",dangerouslyUseHTMLString:!0})},K=()=>{S.confirm("确定结束考试并交卷吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V()})},P=async()=>{await h.postFavouriteQuestion(a.id).then(()=>{var l=f[a.index][0],n=f[a.index][1];e.meta[l].qList[n].favourite=!0,a.favourite=!0,H.success("收藏成功")})};return(l,n)=>{const m=me,v=pe,I=Ae,o=_e,d=fe,t=Le,i=ke,x=Ie,W=ye,X=ve,L=Ne,Q=we,J=ge,Y=Ee,Z=be,z=he;return p(),E(z,{class:"layout-container-exam",style:{height:"100%"}},{default:r(()=>[u(v,null,{default:r(()=>[A("span",null,"【"+g(e.subjectName)+"】"+g(e.name),1),u(Oe,{seconds:e.exam_seconds,type:3,split:D.value,timeUnit:[":",":",":"],stop:e.state==s(_).FINISHED,onTimeUp:V},null,8,["seconds","split","stop"]),u(m,{link:"",type:"primary",disabled:e.state!=s(_).ONGOING,onClick:K},{default:r(()=>[c("交卷")]),_:1},8,["disabled"])]),_:1}),u(z,null,{default:r(()=>[u(d,{width:"164px"},{default:r(()=>[u(o,{style:{height:"100%"}},{default:r(()=>[(p(!0),k(j,null,M(e.meta,y=>(p(),k("div",Fe,[y.qList.length>0?(p(),E(I,{key:0},{default:r(()=>[c(g(y.typeName),1)]),_:2},1024)):b("",!0),y.qList.length>0?(p(),k("div",Se,[(p(!0),k(j,null,M(y.qList,B=>(p(),E(m,{type:B.displayType,onClick:Ue=>C(B.index)},{default:r(()=>[c(g(B.doubt?"❓":B.index+1),1)]),_:2},1032,["type","onClick"]))),256))])):b("",!0)]))),256))]),_:1})]),_:1}),s(a).index>=0?(p(),E(Z,{key:0},{default:r(()=>[A("div",De,[A("div",Ve,[u(t,{size:"small",effect:"dark"},{default:r(()=>[c("考生答案")]),_:1}),c(g(s(a).userAnswer),1)]),e.state==s(_).FINISHED?(p(),k("div",Qe,[u(t,{size:"small",type:"success",effect:"dark"},{default:r(()=>[c("正确答案")]),_:1}),c(g(s(a).answer),1)])):b("",!0),u(i,{type:s(R),size:"small",style:{"padding-left":"6px"}},{default:r(()=>[c("自动下题")]),_:1},8,["type"]),u(x,{modelValue:T.value,"onUpdate:modelValue":n[0]||(n[0]=y=>T.value=y),"inline-prompt":"","active-icon":s(oe),"inactive-icon":s(re)},null,8,["modelValue","active-icon","inactive-icon"]),u(X,{style:{"padding-left":"6px"}},{default:r(()=>[u(m,{disabled:s(a).index<0||s(a).index>=s(f).length||e.state!=s(_).ONGOING,type:"primary",size:"small",onClick:q},{default:r(()=>[c("❓存疑")]),_:1},8,["disabled"]),u(m,{disabled:s(a).index==0,type:"primary",icon:s(le),size:"small",onClick:n[1]||(n[1]=y=>C(s(a).index-1))},{default:r(()=>[c("上题")]),_:1},8,["disabled","icon"]),u(m,{disabled:s(a).index==s(f).length-1,type:"primary",size:"small",onClick:n[2]||(n[2]=y=>C(s(a).index+1))},{default:r(()=>[c("下题"),u(W,{class:"el-icon--right"},{default:r(()=>[u(s(ue))]),_:1})]),_:1},8,["disabled"])]),_:1}),e.state==s(_).FINISHED?(p(),E(m,{key:1,type:"success",icon:s(a).favourite?s(de):s(ce),round:"",size:"small",onClick:P,disabled:s(a).favourite},{default:r(()=>[c("收藏")]),_:1},8,["icon","disabled"])):b("",!0),e.state==s(_).ONGOING?(p(),k("div",ze,[s(a).type==s(O).CHOICE?(p(),E(Q,{key:0,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[3]||(n[3]=y=>s(a).userAnswer=y),onChange:F},{default:r(()=>[u(L,{label:"A"},{default:r(()=>[c("A")]),_:1}),u(L,{label:"B"},{default:r(()=>[c("B")]),_:1}),u(L,{label:"C"},{default:r(()=>[c("C")]),_:1}),u(L,{label:"D"},{default:r(()=>[c("D")]),_:1})]),_:1},8,["modelValue"])):b("",!0),s(a).type==s(O).LOGIC?(p(),E(Q,{key:1,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[4]||(n[4]=y=>s(a).userAnswer=y),onChange:F},{default:r(()=>[u(L,{label:"T"},{default:r(()=>[c("正确")]),_:1}),u(L,{label:"F"},{default:r(()=>[c("错误")]),_:1})]),_:1},8,["modelValue"])):b("",!0),s(a).type==s(O).BLANK?(p(),E(J,{key:2,modelValue:s(a).userAnswer,"onUpdate:modelValue":n[5]||(n[5]=y=>s(a).userAnswer=y),placeholder:"请填入答案，多个答案以英文分号隔开，如: 134;2;abc",clearable:"",onBlur:F},null,8,["modelValue"])):b("",!0)])):b("",!0)]),A("div",$e,[A("div",Me,g(s(a).index+1)+". ("+g(s(a).score)+"分)"+g(s(a).title),1),s(a).image?(p(),E(Y,{key:0,src:s(a).image,fit:"scale-down"},null,8,["src"])):b("",!0),A("div",null,g(s(a).description),1)]),e.state==s(_).FINISHED?(p(),k("div",je,[u(t,{size:"small",type:"success",effect:"dark"},{default:r(()=>[c("题目解析")]),_:1}),c(g(s(a).analysis),1)])):b("",!0)]),_:1})):b("",!0)]),_:1})]),_:1})}}});const nt=xe(He,[["__scopeId","data-v-38f46949"]]);export{nt as default};
