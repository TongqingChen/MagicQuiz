import{d as q,r as B,k as S,c7 as k,e as D,A as c,bA as F,c8 as C,o as d,c as x,w as o,b as r,a as p,t as f,u as b,f as O,p as T,s as $,F as H,ao as g,E as U,c9 as V,a7 as R,bI as z,bJ as A,_ as L}from"./index-e5e4a600.js";import{a as G,E as Q}from"./el-row-966421da.js";import{E as J}from"./el-card-350640ff.js";import{E as s,F as K}from"./FlipCounter-ad0b8c48.js";import{Q as P}from"./http-364f4a0d.js";import{a as X}from"./settings-5434be94.js";const j={class:"question"},W=q({__name:"OralMath",setup(Y){const e=B({id:0,name:"",digital_num:2,max_digital:30,que_num:40,state:s.IDLE,exam_seconds:0,start_time:0,meta:[{title:"",answer:0,user_answer:"",mark:""}]}),h=S(!0),l=k();D(()=>{e.id=Number(l.query.id),e.name=String(l.query.name),e.exam_seconds=Number(l.query.exam_seconds),e.digital_num=Number(l.query.digital_num),e.max_digital=Number(l.query.max_digital),e.que_num=Number(l.query.q_num),e.state=s.ONGOING;var t=c.loadSettings();t&&(h.value=t.data[X.EXAM_TIME_BLINK].value),c.getOralMath(e.id,e.digital_num,e.max_digital,e.que_num).then(u=>{e.meta=[],u.data.forEach(n=>e.meta.push({title:n[0],answer:n[1],user_answer:"",mark:""})),e.start_time=Date.now()})}),F(()=>{e.state=s.FINISHED});const E=async()=>{e.state=s.FINISHED;var t=0,u=0;e.meta.forEach(m=>{var i=String(m.answer)==m.user_answer;m.mark=i?"✅":"❌",t+=i?1:0}),u=e.meta.length-t;var n=c.loadUserIdFromStorage(),a=new P;a.meta.note=`加数:${e.digital_num}个, 最大: ${e.max_digital}; ${t}/${e.meta.length}`,a.meta.user=n,a.meta.quiz=e.id,a.meta.abs_score=Math.round(t*100/e.meta.length),a.meta.rel_score=Math.round(t*100/e.meta.length),a.meta.use_minutes=Math.max(1,Math.round((Date.now()-e.start_time)/1e3/60)),await c.postQuizResult(a.meta),g.alert(`【得分】<b>${a.meta.abs_score}</b>/100<br/>【详情】`+(t==e.meta.length?"恭喜您获得满分<font size='5'>💯</font><br/>":`<b>${t}</b> ✅, <b>${u}<b/> ❌<br/>`)+`【用时】<b>${((Date.now()-e.start_time)/1e3/60).toFixed(2)}<b/>分钟<br/>`,"考试结果",{type:t==e.meta.length?"success":"error",dangerouslyUseHTMLString:!0})},I=()=>{g.confirm("确定结束考试并交卷吗？","请确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E()})};return C((t,u,n)=>{if(e.state!=s.ONGOING){n();return}g.confirm("正在考试中，离开页面数据将会丢失，考试中断！","确认离开吗？",{confirmButtonText:"继续考试",cancelButtonText:"确认离开",type:"warning",closeOnPressEscape:!1,distinguishCancelAndClose:!0}).then(a=>{n(!1)}).catch(a=>{a=="cancel"?n():n(!1)})}),(t,u)=>{const n=U,a=V,m=R,i=J,w=G,y=Q,N=z,v=A;return d(),x(v,null,{default:o(()=>[r(a,null,{default:o(()=>[p("span",null,"【"+f(e.name)+"】",1),r(K,{seconds:e.exam_seconds,type:2,split:h.value,timeUnit:[":",":",":"],stop:e.state==b(s).FINISHED,onTimeUp:E},null,8,["seconds","split","stop"]),r(n,{link:"",type:"primary",disabled:e.state==b(s).FINISHED,onClick:I},{default:o(()=>[O("交卷")]),_:1},8,["disabled"])]),_:1}),r(N,null,{default:o(()=>[r(y,{gutter:16,class:"q-body"},{default:o(()=>[(d(!0),T(H,null,$(e.meta,_=>(d(),x(w,{xs:24,sm:12,md:8,lg:6,xl:4},{default:o(()=>[r(i,null,{default:o(()=>[p("span",j,f(_.title),1),r(m,{class:"clear-number-input",modelValue:_.user_answer,"onUpdate:modelValue":M=>_.user_answer=M,max:9999,clearable:"",type:"number",disabled:e.state==b(s).FINISHED},null,8,["modelValue","onUpdate:modelValue","disabled"]),p("span",null,f(_.mark),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}});const oe=L(W,[["__scopeId","data-v-96b3e204"]]);export{oe as default};
